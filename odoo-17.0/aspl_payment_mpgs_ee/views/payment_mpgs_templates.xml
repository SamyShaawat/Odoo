<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <template id="mpgs_acquirer_button">
            <!-- Include the MPGS Checkout JavaScript library -->

            <script src="https://banquemisr.gateway.mastercard.com/static/checkout/checkout.min.js"

                    data-complete="shop/completeCallback" data-cancel="cancelCallback" data-error="errorCallback">
            </script>

            <!-- Inline JavaScript for MPGS Checkout Configuration -->
            <script type="text/javascript">
                $(document).ready(function() {
                    // Set up variables with data from Odoo

                    const sessionId = "<t t-esc='session_id'/>";

                    // Configure MPGS Checkout with extracted values
                    Checkout.configure({
                       session: {
                        id: sessionId

                        }
                    });

                    // Display the MPGS payment page after a short delay
             
                        try {
                            Checkout.showPaymentPage();
                            console.log("Payment page displayed.");
                        } catch (error) {
                            console.error("Error displaying payment page:", error);
                        }
                    
                });
            </script>

            <!-- Callback Functions -->
            <script type="text/javascript">
                function errorCallback(error) {
                    console.log("error", JSON.stringify(error));
                }
                function cancelCallback() {
                    console.log("cancel");
                    location.reload();
                }
                function completeCallback(resultIndicator, sessionVersion) {
                    console.log("completeCallback");
                    window.location.pathname = '/shop/payment/validate';
                }
            </script>
        </template>
    </data>
</odoo>
